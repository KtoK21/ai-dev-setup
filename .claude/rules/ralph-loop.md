<!-- [.claude/rules/ralph-loop.md] Ralph Loop 플러그인 사용 지침 -->

# Ralph Loop 플러그인 사용 지침

이 파일은 Ralph Loop 플러그인 사용 시 Claude가 따라야 할 지침을 정의합니다.

## Ralph Loop란?

Geoffrey Huntley가 개발한 반복적 개발 방법론으로, 동일한 프롬프트를 Claude에게 반복적으로 제공하여 점진적 개선을 달성합니다.

**핵심 메커니즘:**
- 동일한 프롬프트가 반복됨
- Claude의 이전 작업이 파일과 git 히스토리에 남음
- 각 반복에서 이전 시도를 확인하고 점진적으로 개선

## 사용 가능한 명령어

| 명령어 | 설명 |
|--------|------|
| `/ralph-loop <PROMPT> [OPTIONS]` | Ralph Loop 시작 |
| `/cancel-ralph` | 활성화된 Ralph Loop 취소 |

### 옵션

- `--max-iterations <n>`: 최대 반복 횟수 **(기본값: 10)**
- `--completion-promise <text>`: 완료 신호 문구

### 필수 옵션 규칙

**항상 `--max-iterations 10` 옵션을 포함하십시오.** 무한 루프를 방지하기 위해 최대 10번의 반복 후 자동 중단됩니다.

## 완료 신호 (Completion Promise)

**중요**: Ralph Loop를 종료하려면 반드시 `<promise>` 태그를 출력해야 합니다.

```
<promise>TASK COMPLETE</promise>
```

이 태그가 없으면 무한 반복됩니다.

## Claude 행동 지침

### Ralph Loop 실행 중 따라야 할 규칙

1. **상태 파일 확인**: `.claude/.ralph-loop.local.md` 파일이 존재하면 Ralph Loop가 활성 상태임
2. **이전 작업 검토**: 각 반복 시작 시 이전 변경 사항과 git 히스토리를 확인
3. **점진적 진행**: 한 번에 모든 것을 완료하려 하지 말고 단계적으로 개선
4. **명확한 진행 기록**: 각 반복에서 수행한 작업을 파일이나 주석으로 기록
5. **완료 조건 체크**: 작업이 완료되었는지 매 반복마다 검증

### 완료 판단 기준

다음 조건을 모두 만족할 때 `<promise>` 태그 출력:

- [ ] 요청된 기능/수정이 완료됨
- [ ] 관련 테스트가 통과함 (테스트가 있는 경우)
- [ ] 코드가 빌드/실행됨
- [ ] 명백한 오류나 경고가 없음

### 반복 패턴

```
1. 현재 상태 파악 (파일, git diff, 테스트 결과)
2. 이전 반복에서 수행한 작업 확인
3. 다음 단계 결정 및 실행
4. 결과 검증
5. 완료 조건 충족 시 <promise> 출력, 아니면 계속 진행
```

## 최대 반복 도달 시 실패 처리

**10번 반복 후에도 완료되지 않으면** 다음 절차를 따릅니다:

### 1. 실패 보고서 작성

`.claude/ralph-failures/` 디렉토리에 실패 보고서를 생성합니다.

**파일명 형식:** `{YYYY-MM-DD}_{작업명}.md`

**예시:** `2026-01-19_auth-token-fix.md`

### 2. 실패 보고서 템플릿

```markdown
# Ralph Loop 실패 보고서

## 기본 정보

- **작업명**: [프롬프트에서 추출한 작업 설명]
- **시작 시간**: [루프 시작 시간]
- **종료 시간**: [루프 종료 시간]
- **총 반복 횟수**: 10

## 작업 목표

[원래 요청된 작업 내용]

## 진행 상황

### 완료된 부분
- [완료된 작업 1]
- [완료된 작업 2]

### 미완료 부분
- [미완료 작업 1]
- [미완료 작업 2]

## 실패 지점 분석

### 마지막 시도에서 발생한 문제
[구체적인 오류 메시지 또는 실패 상황]

### 반복적으로 실패한 패턴
[여러 반복에서 관찰된 공통 문제점]

## 근본 원인 추정

- [원인 1]
- [원인 2]

## 해결 방안 제안

### 즉시 시도할 수 있는 방법
1. [방법 1]
2. [방법 2]

### 추가 조사가 필요한 부분
1. [조사 항목 1]
2. [조사 항목 2]

### 사용자 개입이 필요한 사항
1. [필요 사항 1]
2. [필요 사항 2]

## 관련 파일

- [수정된 파일 목록]
- [참고해야 할 파일 목록]

## 다음 단계 권장사항

[재시도 전 권장 조치사항]
```

### 3. 실패 처리 행동 규칙

1. **즉시 중단**: 10번째 반복이 끝나면 더 이상 시도하지 않음
2. **상태 보존**: 현재까지의 변경 사항은 커밋하지 않고 유지
3. **보고서 생성**: 위 템플릿에 따라 실패 보고서 작성
4. **사용자 알림**: 실패 보고서 경로를 사용자에게 안내

## 적합한 사용 사례

**적합:**
- 명확한 성공 기준이 있는 작업
- 반복과 개선이 필요한 작업
- 새 프로젝트 구축 (Greenfield)
- 테스트 기반 개발

**부적합:**
- 사람의 판단이나 설계 결정이 필요한 작업
- 일회성 작업
- 성공 기준이 불명확한 작업
- 프로덕션 디버깅

## 예시

### 기본 사용

```
/ralph-loop "auth.ts의 토큰 갱신 로직을 수정하세요. 모든 테스트가 통과하면 <promise>FIXED</promise>를 출력하세요." --completion-promise "FIXED" --max-iterations 10
```

### 기능 구현

```
/ralph-loop "사용자 프로필 페이지를 구현하세요. 완료되면 <promise>DONE</promise>을 출력하세요." --max-iterations 10 --completion-promise "DONE"
```

## 참고 자료

- 원본 기법: https://ghuntley.com/ralph/
- Ralph Orchestrator: https://github.com/mikeyobrien/ralph-orchestrator
