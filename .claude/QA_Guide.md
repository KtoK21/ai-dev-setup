# QA 빌드 점검 가이드

이 문서는 프로젝트의 빌드 점검 프로세스를 정의합니다. 각 단계를 순서대로 수행하세요.

---

## 점검 프로세스 개요

```
1. 빌드 테스트 → 2. 코드 리뷰 → 3. 이슈 선택 및 수정 → 4. (추후 확장) → 5. 결과 보고
```

> **흐름**: code-reviewer가 이슈 목록을 보여주면, 사용자가 수정할 이슈를 선택합니다. 선택된 이슈만 issue-fixer가 수정합니다.

---

## 1단계: 빌드 테스트

### 1.1 의존성 확인
```bash
npm install
```

### 1.2 개발 빌드 테스트
```bash
npm run dev
```
- 에러 없이 서버가 시작되는지 확인

### 1.3 프로덕션 빌드 테스트
```bash
npm run build
```
- 빌드 에러 발생 여부 확인
- 번들 크기 확인

---

## 2단계: 코드 리뷰 (이슈 즉시 문서화)

**중요**: 이슈를 하나 발견할 때마다 즉시 `.claude/issues/` 폴더에 이슈 파일을 생성합니다.
이렇게 하면 컨텍스트가 흐려지지 않고, issue-fixer가 나중에 참고할 수 있는 명확한 문서가 남습니다.

### 코드 리뷰 프로세스

#### 방법 1: code-reviewer 에이전트 사용 (등록된 경우)

**에이전트**: `code-reviewer`

Task 도구를 사용하여 code-reviewer 서브 에이전트를 호출하세요:
- subagent_type: "code-reviewer"
- prompt: "프로젝트 전체 코드를 리뷰해주세요. 각 파일을 검토하고, 코드 품질, 보안, 성능, 유지보수성 관점에서 피드백을 제공해주세요. **중요**: 이슈를 하나 발견할 때마다 즉시 `.claude/issues/issue-{id}-{severity}.md` 파일을 생성한 후, 다음 이슈를 찾으세요."

#### 방법 2: 직접 리뷰 (code-reviewer 미등록 시)

메인 에이전트가 직접 파일을 읽고 리뷰합니다:

1. **파일 순회하며 검토**
   - 프로젝트의 주요 파일들을 하나씩 읽습니다
   - 각 파일에서 이슈를 찾습니다

2. **이슈 발견 즉시 문서화**
   - 이슈를 하나 발견하면 **즉시** `.claude/issues/` 폴더에 이슈 파일 생성
   - 파일명: `issue-{id}-{severity}.md`
   - 내용: 아래 템플릿 사용

3. **다음 이슈로 진행**
   - 이슈 파일을 생성한 후 계속해서 다음 이슈를 찾습니다
   - 모든 파일 검토가 끝날 때까지 반복

### 리뷰 범위
프로젝트 구조에 따라 조정:
- HTML/CSS/JS 프로젝트: `index.html`, CSS 파일, JS 파일
- React 프로젝트: `src/` 디렉토리, 설정 파일들
- 공통: 프로젝트 명세 문서와의 일치성 검토

### 이슈 파일 템플릿

이슈를 발견하면 즉시 다음 템플릿으로 `.claude/issues/issue-{id}-{severity}.md` 파일을 생성합니다:

```markdown
---
id: {순차번호}
severity: critical|warning|suggestion
file: {파일명}
line: {라인번호 또는 범위}
status: pending
created: {YYYY-MM-DD}
---

# 이슈 #{id}: {이슈 제목}

## 설명
{이슈에 대한 명확한 설명}

## 문제점
- {구체적인 문제점 1}
- {구체적인 문제점 2}

## 관련 코드
```{언어}
{해당 코드 발췌}
```

## 수정 방향
{어떻게 수정해야 하는지 구체적 가이드}

## 수정 이력
- [pending] 이슈 생성됨
```

### 리뷰 기준
| 등급 | 의미 | 조치 |
|------|------|------|
| 🔴 Critical | 반드시 수정 필요 (보안, 빌드 실패 등) | 사용자 선택 시 수정 |
| 🟡 Warning | 권장 수정 (성능, 접근성 등) | 사용자 선택 시 수정 |
| 🟢 Suggestion | 선택적 개선 (코드 스타일, 최적화) | 사용자 선택 시 수정 |

### 리뷰 완료 후

**사용자에게 안내**:
```
코드 리뷰가 완료되었습니다.

발견된 이슈:
- 🔴 Critical: N건
- 🟡 Warning: N건
- 🟢 Suggestion: N건

.claude/issues/ 폴더에 각 이슈별 문서가 생성되었습니다.

수정할 이슈 번호를 알려주세요. (예: "1, 3, 5번 수정해줘" 또는 "Warning 전부 수정해줘")
```

사용자가 수정할 이슈를 선택할 때까지 대기합니다.

---

## 3단계: 이슈 선택 및 수정 (하이브리드 방식)

사용자가 선택한 이슈를 **2단계 하이브리드 방식**으로 수정합니다:
1. **1차 시도**: 서브 에이전트 병렬 처리 (빠른 수정)
2. **2차 시도**: 실패한 이슈만 Ralph Loop로 순차 재시도 (깊이 있는 수정)

**중요**: 이슈 파일은 이미 2단계에서 생성되어 `.claude/issues/` 폴더에 존재합니다.

### 3.1 이슈 파일 확인

사용자가 수정할 이슈를 선택하면:
1. `.claude/issues/` 폴더에서 해당 이슈 파일을 확인
2. 이슈 파일이 없으면 에러 (2단계에서 생성되었어야 함)

### 3.2 1차 시도: 서브 에이전트 병렬 처리

모든 선택된 이슈를 issue-fixer 서브 에이전트로 **병렬 처리**합니다.

#### 병렬 호출 방법

**단일 메시지에서 여러 Task를 동시에 호출**해야 병렬 실행됩니다:

```
// 하나의 메시지에서 여러 Task를 동시에 호출 (병렬 실행)
Task({ subagent_type: "issue-fixer", prompt: "이슈 #1 수정: .claude/issues/issue-1-critical.md" })
Task({ subagent_type: "issue-fixer", prompt: "이슈 #2 수정: .claude/issues/issue-2-warning.md" })
Task({ subagent_type: "issue-fixer", prompt: "이슈 #3 수정: .claude/issues/issue-3-suggestion.md" })
```

#### 파일별 그룹화 규칙

같은 파일의 이슈는 순차 처리, 다른 파일의 이슈는 병렬 처리:

```
파일 A의 이슈: [#1, #3, #5]  → 순차 처리 (1 → 3 → 5)
파일 B의 이슈: [#2, #4]     → 순차 처리 (2 → 4)
파일 A와 B                  → 병렬 처리 가능
```

#### 1차 시도 결과 수집

각 서브 에이전트 완료 후:
- **성공**: 이슈 파일 status가 `fixed`로 변경됨
- **실패**: 이슈 파일 status가 `failed`로 변경됨

### 3.3 2차 시도: Ralph Loop로 실패 이슈 재시도

1차에서 실패한 이슈(`status: failed`)가 있으면, Ralph Loop로 **순차 재시도**합니다.

```
/ralph-loop "버그 수정: [실패한 이슈 설명]

단계:
1. 버그 재현
2. 근본 원인 파악
3. 수정 구현
4. 회귀 테스트 작성
5. 수정 동작 확인
6. 새로운 문제 발생 여부 확인

완료되면 <promise>FIXED</promise>를 출력하세요." --max-iterations 10 --completion-promise "FIXED"
```

#### Ralph Loop 완료 조건

- **성공**: `<promise>FIXED</promise>` 출력 시 루프 종료
- **실패**: 10번 반복 후에도 미완료 시 자동 중단
  - 이슈 파일에 실패 보고서 이어서 작성
  - 차단 요소, 시도한 접근법, 대안 제시 포함

### 3.4 이슈 파일 관리

#### 삭제 조건

다음 상황에서 이슈 파일을 삭제합니다:

1. **수정 완료**: 1차 또는 2차 시도에서 성공적으로 수정 완료
2. **수정 불필요**: 사용자가 "N번 이슈는 수정 안해도 돼" 라고 말함
3. **수정 보류**: 사용자가 "N번 이슈는 나중에 할게" 라고 말함

**삭제 시 메인 에이전트 동작**:
```
1. .claude/issues/issue-{id}-{severity}.md 파일 삭제
2. 사용자에게 알림: "이슈 #N 파일이 삭제되었습니다."
```

#### 실패 이슈 보존

2차 시도(Ralph Loop)에서도 실패한 이슈는:
- 이슈 파일을 삭제하지 않고 **보존**
- 이슈 파일 하단에 실패 보고서가 추가된 상태로 유지
- 사용자가 수동으로 검토하거나 나중에 재시도 가능

### 3.5 현재 이슈 상태 확인

`.claude/issues/` 폴더에 남아있는 파일들이 현재 진행 중인 이슈입니다.

**상태 확인 명령**:
- 사용자: "현재 이슈 상태 보여줘"
- 메인 에이전트: `.claude/issues/` 폴더의 파일 목록과 각 파일의 status 표시

**status 값**:
| status | 의미 |
|--------|------|
| `pending` | 아직 수정 시도하지 않음 |
| `in_progress` | 수정 진행 중 |
| `fixed` | 수정 완료 |
| `failed` | 수정 실패 (실패 보고서 포함) |
| `skipped` | 사용자가 건너뛰기 요청 |

### 3.6 수정 후 검증

모든 이슈 수정 시도가 완료되면:

1. **재빌드 테스트**:
   ```bash
   npm run build
   ```

2. **빌드 실패 시**:
   - 실패 원인 분석
   - 관련 이슈 재수정 (Ralph Loop 재실행)

3. **성공 시**:
   - 수정 완료된 이슈 파일 삭제
   - 결과 보고로 진행

---

## 4단계: 추가 점검 (확장 예정)

> 아래 항목들은 추후 서브 에이전트가 추가되면 업데이트됩니다.

- [ ] **성능 테스트 에이전트** - Three.js 렌더링 성능 분석
- [ ] **보안 점검 에이전트** - 의존성 취약점 스캔
- [ ] **접근성 점검 에이전트** - 웹 접근성 검토
- [ ] **테스트 커버리지 에이전트** - 단위 테스트 현황 분석

---

## 5단계: 결과 보고

### 보고서 형식

```markdown
## QA 빌드 점검 결과

**점검 일시**: YYYY-MM-DD HH:MM
**점검자**: [이름/에이전트]
**대상 브랜치**: [브랜치명]

### 빌드 상태
- [ ] npm install: ✅ 성공 / ❌ 실패
- [ ] npm run dev: ✅ 성공 / ❌ 실패
- [ ] npm run build: ✅ 성공 / ❌ 실패

### 코드 리뷰 요약
- Critical 이슈: N건
- Warning 이슈: N건
- Suggestion: N건

### 이슈 수정 결과
- 수정 완료: N건
- 수정 보류: N건 (사유: ...)
- 재빌드 결과: ✅ 성공 / ❌ 실패

### 주요 발견 사항
1. [내용]
2. [내용]

### 권장 조치
1. [내용]
2. [내용]

### 최종 판정
- [ ] ✅ 배포 가능
- [ ] ⚠️ 조건부 배포 가능 (경미한 이슈 존재)
- [ ] ❌ 배포 불가 (Critical 이슈 해결 필요)
```

---

## 빠른 점검 체크리스트

일상적인 점검 시 아래 체크리스트를 활용하세요:

- [ ] `npm run build` 성공
- [ ] Critical 이슈 0건
- [ ] 새로 추가된 코드 리뷰 완료
- [ ] Critical/Warning 이슈 수정 완료
- [ ] 수정 후 재빌드 성공
- [ ] git status 확인 (불필요한 파일 커밋 방지)

---

## 참고

### 관련 서브 에이전트
| 에이전트 | 파일 위치 | 용도 |
|----------|----------|------|
| code-reviewer | `.claude/agents/code-reviewer.md` | 코드 품질/보안/성능 리뷰 |
| issue-fixer | `.claude/agents/issue-fixer.md` | 개별 이슈 자동 수정 |

### 문서 이력
- 2025-12-22: 코드 리뷰 프로세스 개선 - 이슈 발견 즉시 파일 생성 방식으로 변경
- 2025-12-20: 병렬 처리 규칙 강조 및 구체적 예시 추가
- 2025-12-20: 사용자 선택 기반 이슈 수정 프로세스로 변경, 임시 이슈 파일 관리 추가
- 2025-12-20: issue-fixer 에이전트 및 이슈 수정 프로세스 추가
- 2024-12-20: 최초 작성, 코드 리뷰 프로세스 추가
